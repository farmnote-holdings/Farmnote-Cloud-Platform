# 繁殖計画機能 v3移植要件定義

## 1. はじめに

### 1.1. 目的とゴール

Cloud Platform v3のアーキテクチャに統合することで、他の機能（個体リスト、データ分析機能など）とのシームレスな連携を実現し、ロジックを整合させ、ユーザー体験を向上させる。

---

## 2. 対象機能の概要

### 2.1. 機能名


### 2.2. 繁殖計画の機能概要

ゲノム情報と個体の出生と繁殖データに基づき、最適な種付け方法・品種の割当を提案し、計画的生産をサポートする。


---

## 3. 現状分析 (As-Is)

### 3.1. 他社ゲノム事業との差別化要因

- 「メイティングとゲノム検査」× **繁殖データ**で計画を立てることができる
    - 繁殖データがあることで、繁殖開始タイミングがわかり、子牛の計画的生産が可能になる。
    - 出生と最終分娩データがあることで、未経産牛と経産牛の繁殖開始タイミングが計算でき、最適な計画を立てることができる。
- [記載待ち: その他の差別化要因]

### 3.2. ユーザー価値と利用状況

- **主要ターゲットユーザー**: 
    - ファームノートソリューションセールス：
    - 生産者：
- **提供しているユーザー価値**: 
	1. 後継牛の推薦およびCloudへの連携
    2. 繁殖インデックスによる和牛受精卵移植対象の選抜が可能で、繁殖計画レポートを参考に、足切りラインを確認し繁殖方針ガイド機能の設定ができる
    3. 種付け品目の割当の複雑な計算の手間を解消する。
	    - 例えば、個体リストのみで同様の計算をする場合、繁殖開始目安日ごとの牛の分割、NM$での並び替え、必要頭数のカウントを行い、足切り条件を設定した後、複数の個体リスト（NM、繁殖インデックス、3ヶ月ごとx4期間=12リスト）を作成する必要があるため、計算に手間がかかる。
- **利用状況・頻度**: 
    - 農協の精液選定表が変わったタイミングでの、計画の再計算は調整は必須
    - セールスのヒアリングベースでは、3ヶ月に一度は各牧場で見直しを掛けているとのこと
    - 繁殖方針ガイドは利用ユーザーは限定的だと思われる
	    - ソリューションにヒアリングしても、「繁殖方針ガイドは使ってはいるが全ユーザーではない」という回答
- 参考
	- [繁殖計画レポートのアップデートリリース](https://docs.google.com/presentation/d/1-tjPC-VFhi6NtxE2uJSWkZ_RUaQZd_uk-KexkZaS0Zo/edit?usp=sharing)
	- [繁殖方針ガイド機能のリリースノート](https://docs.google.com/presentation/d/1bxDtfWwHtJqLZbOcSbT1FdDl1m4ld8uFY4lyJBWFtAE/edit?usp=sharing)
    - [個体リストの使い方_1](./samples/images/村崎牧場の使い方_1.png)
    - [個体リストの使い方_2](./samples/images/村崎牧場の使い方_2.png)

### 3.3. 現状の課題・問題点

- **UI上の課題**: 
    1. Cloud側の繁殖開始目安日とGene内部の繁殖開始日が異なっており、レポートと個体リストの内容が一致しない（結果として問い合わせが発生している）。
        - Gene上は、1〜3月、4〜6月、7〜9月、10〜12月で区間を区切っており固定。これに従って、個体リスト上で「繁殖開始目安日」ごとに分割し、NM$で並び替えると、Cloudで計算された繁殖開始目安日とGeneで計算した繁殖開始日がズレいてるため、区間をまたぐ牛が発生する。結果として、並び替えた内容が一致しなくなる、という現象が起きる。
    2. 繁殖推薦が「後継牛」のみに限定されている。
    3. 調整ができない。繁殖計画の計算を実行すると、Cloudの繁殖推薦に即時連携されるため、調整ができず、システムのしばりが強い。
    4. 「繁殖方針ガイド」と「繁殖推薦」の役割が不明瞭。

---

## 4. v3で提供する新しい価値 (To-Be)

設計思想
- [記載待ち]

### 4.1. ユーザー体験の向上案

v3への移行にあたり、ユーザーがより直感的かつ効率的に繁殖計画を立案・実行できるよう、以下の3つの体験向上を目指します。

1.  **ユーザー中心のアクセスとシームレスな連携**
    - メインユーザー（FNソリューション or 生産者）を明確に定義し、そのユーザーのワークフローに最適化された機能配置を行います。
    - 計画作成からCloud上の関連機能（タスク管理など）への連携まで、一貫した操作感で完結できるようにします。
2.  **柔軟な計画調整機能**
    - 自動計算した計画を即時反映するのではなく、ユーザーが内容を確認・手動調整できるステップを設けます。これにより、現場の状況に応じた柔軟な意思決定を支援します。
3.  **データとロジックの統一による混乱の解消**
    - 繁殖ポリシーや「繁殖開始目安日」の計算ロジックをCloudプラットフォームと完全に一致させます。これにより、データの不整合に起因するユーザーの混乱や問い合わせをなくします。
4.  **精液切り替わりタイミングにおける在庫解消**
    - 一部の牛に対して、過去にメイティングした精液の情報を読み出せるように、現場で在庫の引き当てをしやすくします。

### 4.2. ビジネス価値の向上
- [記載待ち: 売上向上、コスト削減、データ活用など、ビジネスへの貢献]

---

## 5. 機能要件案

must have/nice to haveも全部含めて記載

### 5.1. 繁殖ポリシー
- 現状の画面： [繁殖ポリシー画面1](./samples/images/繁殖ポリシー画面_1.png)、[繁殖ポリシー画面2](./samples/images/繁殖ポリシー画面_2.png) 

1. ユーザーがCloud上で繁殖ポリシーを設定できるようにする
2. 後継牛を確保する際の頭数バッファについて、より直感的でわかりやすい表記（例：未経産牛0.9頭・経産牛0.8頭）に改善する（戻す）
    - 現状は、「受胎率」からバッファを自動計算しているが、より直接的な計算のほうが直感的だと思われる。
3. 各種種付け項目に対応
    - ホル受精卵の利用ができるように修正する
    - ホル通常精液
    - 屠畜卵

### 5.2. 繁殖計画
- 現状の画面： [繁殖計画レポート](./samples/okasoto_lN2vOz4vdD/latest_breeding_plan.html) 

1. ユーザーが繁殖計画レポートを常に確認できるようにする
2. 計画の自動計算をしたあと、確認・調整をできるようにする
    - [画面案1](./samples/images/計画調整画面_1.png)
    - [画面案2](./samples/images/計画調整画面_2.png)
3. 古い精液によるメイティング結果を適用できるようにする
    - 一つ前のメイティングをフリックできるようにするなど（？）。現状、UI案なし。
4. 繁殖方針ガイドで、詳細なルールを選べるようにする（？）
    - 繁殖方針ガイド自体が必要なのか要調査

### 5.3. 内部ロジックやCloudの設定

1. 「産次別VWP」を設定可能にし、「繁殖開始目安日」の計算ロジックを統一化する
2. 受胎品種に応じた分娩予定日の設定（ホル/和牛）
    - 「繁殖開始目安日」に影響する。素朴な変更だが影響は大きい。

### 5.4. その他

1. 個体リストの閲覧数限界を現状の100件から拡張する
    - 繁殖計画で大枠を決め、更に詳細なコントロールが必要な場合、繁殖方針ガイドを設定する、というユースケースを想定した場合
        - 繁殖推薦で、「ホルX、和牛ET、和牛AI」が割り当てられた牛に、より詳細な繁殖方針ガイドを割り当てる際、現状は個体リストからのみ割当が可能なため、一括割当の際に、個体リストの閲覧数100件だと足りないケースがある。
2. 繁殖方針ガイド機能との自動連携は解除（した方が良い？）
    - 5.2の3の設計準じて、繁殖方針ガイドの修正が必要か

### 5.5 対象外（やらないこと）

- 繁殖除外牛の決定
- 過去の振り返り機能
- 現状の牛群ポテンシャルと実績の比較機能
- 課題発見の自動化
- 特定の季節で後継牛の繁殖を停止するなどの季節要因の考慮

---

## 6. 影響範囲と依存関係

### 6.1. 関連する機能

- **依存している機能**: 
    - 

- **依存されている機能**: 
    - タスク管理機能（推奨される授精タスクの生成など）


---

## 7. 技術的評価

### 7.1. データ・実装移行

- **移行が必要なデータ**: [記載待ち: v3へ移行する必要があるデータとその規模]
- **データ移行方針**: [記載待ち: 移行手順、ダウンタイムの有無、データの整合性担保策など]

### 7.2. 実装難易度

- **評価**: [高/中/低]
- **理由**: [記載待ち: 実装が困難な点、技術的課題、不確実性など]


---

## 8. コスト評価

### 8.1. 概算開発工数

| フェーズ | 工数 (人日) | 備考 |
|:---|:---:|:---|
| 設計 | [記載待ち] | |
| 実装 | [記載待ち] | |
| テスト | [記載待ち] | |
| データ移行 | [記載待ち] | |
| **合計** | **[記載待ち]** | |

### 8.2. 必要なリソース

- **役割**: [記載待ち: フロントエンド、バックエンド、インフラ、QAなど]
- **スキルセット**: [記載待ち: 特定の言語、フレームワーク、クラウドサービスの経験]

### 8.3. 運用コストへの影響

- **インフラコスト**: [記載待ち: サーバー費用、SaaS利用料などの増減]
- **保守・サポートコスト**: [記載待ち: 問い合わせ対応、障害調査などの工数の増減]

---

## 9. 優先度評価

### 9.1. ビジネスインパクト

- **評価**: [高/中/低]
- **理由**: [記載待ち: 売上への貢献度、顧客満足度への影響、戦略的重要性など]

